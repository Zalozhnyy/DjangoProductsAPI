
Сервер развёрнут по адресу https://regulations-1972.usr.yandex-academy.ru

Документация к API представлена в файле `openapi.json`.

Развёртывание приложения
========================
Приложение упаковано в docker контейнеры. Для его развёртывания достаточно запустить контейнеры.
Для развертывания необхоним docker-compose.

### Сборка и запуск контейнера
    docker-compose -f docker-compose.prod.yaml up --build -d

### Применение миграций
    docker-compose -f docker-compose.prod.yaml exec web python manage.py migrate

#### Проверка создания бд
Проверить создана ли база данных можно с помощью комманд:
    
    docker-compose exec db psql --username=hello_django --dbname=postgres
    \l
В списке БД должна быть `hello_django_prod`



Тесты
========================
Для запуска тестов необходимо проверить разрешения юзера БД
    
    docker-compose exec db psql --username=hello_django --dbname=postgres
    \du+

Необходимо разрешение `Create DB`

### Запуск тестов

Для запуска тестов выполните команду:
    
    docker-compose -f docker-compose.prod.yaml exec web python manage.py test .

Принцип работы приложения
========================

#### Добавление/изменение товара(категории)

При добавлении/звенении товара создаётся множество товаров у которых изменилась цена.
Для предков изменившихся товаров запускается перерасчет средней стоимости с помощью вспомогательной таблицы `PriceCalculation`.


#### Удаление товара/категории
При удалении товара/категории из родительской записи `PriceCalculation` вычитываются значения удаляемого элемента.
Так же корректируются средние цены в таблице `ItemModel`

#### Получение товара по uuid
Логика составления дерева дочерних объектов заключена в классах: `ItemChildrenSerializer` и `ChildrenSerializer`

#### История цен товаров

История цен товаров и категорий хранится в таблице `PriceHistory`.
Записи добаляются при создании/обновлении товара.
В таблице есть условие на уникальность полей id и даты. (не может быть две цены у одного товара в один и тот же момент времени).
